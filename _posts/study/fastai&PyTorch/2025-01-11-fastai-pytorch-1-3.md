---
layout: post
title: "fastai & PyTorch (1~3)"
date: 2025-01-11 14:00:00 +0900
categories: fastai&PyTorch,DeepLearning
tags: fastai,DeepLearning,PyTorch
---

# fastai & PyTorch (1~3)

# Chapter 1, Intro







딥러닝

- 여러 계층의 인공신경망을 사용하여 데이터를 추출하고 변형하는 기법
- 각 계층의 출력은 다음 계층의 입력이 된다.
- 딥러닝을 활용한 다양한 분야 - NLP, 영상처리, 의학, 생물학, 이미지생성 등등
- 보통 신경망이라는 단일 모델에서 시작된다.

📌 PDP(Parallel Distributed Processing) 병렬 분산 처리

- PDP가 제시한 접근법은 오늘날 신경망에서 사용하는 접근법과 매우 유사
- 처리 유닛 집합
- 활성 상태
- 각 유닛의 출력 함수
- 유닛 간의 연결 패턴
- 연결망으로 활동 패턴을 전파하는 전파규칙
- 유닛의 현재 상태에 영향을 주는 입력을 결합하여 유닛의 출력을 생성하는 활성화 규칙
- 경험에 따라 연결 패턴을 바꾸는 학습 규칙
- 시스템이 작동하는 환경

📌 가중치(파라미터) 할당

- 가중치는 단지 변수일 뿐이고, 가중치 할당은 변수에 대해 선택된 특정값이다.
- 가중치는 매우 중요하다. 가중치에 따라 얼마나 많은 문제를 해결할 수 있는지도 정해진다. 가중치를 자동으로 갱신해나가며 할당해주는 방식을 찾아왔고, 작업의 종류에 상관없이 신경망의 가중치를 갱신하며 결과를 개선해나가는 보편적 방법 중 한가지

📌 과적합

- 학습용 데이터와 검증용 데이터로 나누어 학습을 해야 과적합을 방지할 수 있다.

📌 평가지표

- 검증용 데이터셋을 사용하여 모델이 내놓은 예측의 품질을 측정하는 함수 마지막 에포크에 출력이된다.

📌 평가지표 VS 손실

- 손실의 목적 : 가중치를 자동으로 갱신하는 데 사용할 수 있는 ‘성능 측정’
    - 역전파 (Backpropagation)
        1. 입력 데이터가 네트워크를 통과하여 예측값을 계산
        2. 예측값과 실제 값 간의 오차를 손실 함수로 계산
        3. 손실을 각 층에 대해 뒤로(반대로) 전파하며, 기울기(가중치를 얼마나 어떤 방향으로 수정해야 손실이 줄어드는지)를 계산
        4. 기울기에 따라 가중치를 수정.
- 평가지표 : 사람이 활용할 수 있는 형태로 정의되었다.

📌 모델의 계층 수

- 계층 구조가 많으면 더 과적합되는 경우가 있다.

📌 에포크 (Epoch)

- 데이터 전체를 한 번 학습하는 과정
- 너무 적으면 학습부족 (Underfitting), 너무 많으면 과적합 (Overfitting)
- Early Stopping 같은 기법으로 최적의 에포크 수를 찾음

📌 cnn_learner 함수 안에 내장되어있는 pretrained

- 전문가가 미리 학습시켜 얻은 가중치(Weight)를 모델의 가중치로 설정
- 사전학습모델이라고 부르며, 이것의 가능성이 유용할때가 많다.
- 보통 처음에는 신경망을 학습할때 무작위(Random)의 가중치를 가지고 학습을 시작함. 하지만, 이미지의 기본적인 특징을 이미 잘 학습한 상태의 가중치인 pretrained를 사용하면 유용하다.

💡 pretrained 모델을 쓰는이유

- 학습 속도 증가 (이미 좋은 가중치를 가지고 시작하기 때문)
- 적은 데이터로도 좋은 성능 ( 기존에 학습한 일반적인 패턴을 활용할 수 있기 때문에 적은 데이터로도 성능이 좋음 )
- 더 높은 성능 ( 처음부터 학습시키는 것보다 사전 학습된 모델을 미세조정하는 것이 일반적으로 더 좋은 성능을 보인다 )

💡 그렇다면 pretrained 모델은 어떤 이미지를 가지고 학습된 가중치를 가지고 있을까? (어떤 종류의 이미지를 학습할때에는 사용하고 사용하지 말아야할까? 그 기준이 어떻게 될까?)

- 보통 ImageNet으로 학습되기 때문에 일반적인 물체(강아지,고양이,자동차,사람,새,사과 등등)가 포함된 이미지 데이터셋을 가지고 학습된다. 그렇기 때문에 일반적인 물체의 이미지를 분류하는 문제에 적용하면 좋다.
- 하지만 완전히 다른 도메인의 이미지를 분류하는 문제에 대해서는 사용하지 않는것이 더 좋다. ex. X-ray, 위성사진, 전자 현미경 이미지 등등
- 하지만 완전히 다른 도메인의 이미지라도, pretrained 모델을 활용할 수 있다. (기본적인 패턴 (엣지,색깔,질감 등)은 그대로 두고, 최종 분류만 새롭게 학습 ) ⇒ 이러한 과정을 Fine-Tuning이라고 한다.

📌 파라미터

- 모델이 학습을 통해 찾는 값을 의미한다. → 가중치(Weight), 편향(Bias)

 

| 개념 | 설명 |
| --- | --- |
| 레이블 | 예측하려는 데이터 |
| 구조/아키텍쳐 | 적합하려는 모델의 템플릿 |
| 모델 | 특정 조합의 파라미터와 결합된 아키텍처 |
| 파라미터 | 모델이 학습되는 동안 갱신되어 모델이 하는 일을 바꾸는 값 |
| 적합/학습 | 주어진 입력 데이터를 사용하는 모델의 에측이 타깃 레이블과 일치되게끔 모델의 파라미터를 갱신하는 과정 |
| 사전 학습된 모델 | 일반적으로 대규모 데이터셋에서 이미 학습되었으며, 미세 조정해야 하는 모델 |
| 미세 조정 (Fine-Tuning) | 다른 작업을 위해 사전 학습된 모델을 갱신하는 과정 (원하는 목적에 맞게 미세 조정하는 과정) |
| 에포크 (Epoch) | 모든 입력 데이터가 모델에 한 번씩 통과된 상황 |
| CNN | 영상 처리 작업에서 특히 잘 작동하는 신경망인 합성곱 신경망 |

🎯 머신러닝은 프로그램을 직접 작성하지 않고 데이터에서 학습하여 프로그램을 만드는 학문이다. 딥러닝은 머신러닝의 한 분야로 여러 계층으로 구성된 신경망을 사용한다.

# Chapter 2, Production

**📌** 딥러닝의 예시 : 이미지 분류(Computer Vision) 

- 레이블된 데이터 (이미지에 이미지가 나타내는 내용을 표시하는 레이블을 할당한 데이터)
- 새로운 이미지가 무엇을 나타내는지 정확히 예측하는 모델을 만드는 것
1. 구조/아키텍처를 고른다. (특정 유형의 모델이 내부적으로 작동하는 방식에 관한 일반적인 템플릿) → 기본적인 구조 및 틀이라고 생각하면 편하다. 
2. 모델 학습 → 해당 템플릿을 우리의 데이터에서 잘 작동하게끔 만드는 특정 파라미터의 값 (가중치 Weight)을 찾는 과정이다. 
    
    2-1 → 학습 과정을 빠르게 하려면 사전 학습된 모델을 사용하여 시작한다. 그 후 해당 모델을 우리의 데이터에맞게 더 학습시키는 Fine Tuning (미세조정)을 거치면 더 빠르게 학습과정이 이루어진다.
    
3. 손실 함수 정의 → 예측의 좋고 나쁨을 측정
4. 과적합 방지 → 학습데이터와 검증데이터를 나눈다. 학습데이터를 통해 배운 내용들을 검증데이터에서도 잘 일반화할 수 있는지 확인

🚀 위와 같은 과정은 머신러닝, 딥러닝 모두에 일반적으로 적용된다. 딥러닝은 특별히 CNN(신경망)을 기반으로 하는 특수한 구조를 지니고있다.

## 다양한 분야에서의 딥러닝

사진에서 물체의 위치를 파악하는 기술

### 컴퓨터 영상 처리

세그멘테이션

- 이미지의 모든 개별 픽셀을 인식하는 모델을 만드는 것
- 물체 인식 - 이미지 내 물체를 인식하는 작업
- 물체 탐지 - 이미지 내 물체의 위치 식별, 물체의 이름 및 위치 표시

데이터 증강 

- 입력 이미지를 회전하거나 명도 및 채도를 바꾸는 등 다양한 합성 이미지를 생성하는 기법 (이미지 뿐만 아니라 텍스트 등 다양한 모델에 유용)

### 텍스트 (자연어 처리)

- 짧거나 긴 문서를 스팸, 긍정/부정, 작성자, 소스 웹사이트 등에 따라 능숙하게 분류 가능
- 자동 텍스트 생성 기술은 텍스트의 자동 생성 여부를 탐지하는 기술보다 항상 조금씩 앞서있다.

### 추천 시스템

- 일반적으로 사용자와 상품을 표현하는 카디널리티가 높은 변수가 있다는 특징을 가지고 있다.
    - 카디널리티? → 주어진 데이터에서 고유한 값의 개수 (만약 ‘도시’라는 변수에 도시이름이 10개가 있으면    카디널리티는 10이다.)
- ex.) Amazon 에서는 고객을 행, 제품을 열로 표현하는 거대한 희소 행렬로 모든 구매 이력을 표현한다. 그 . 후 DataScientist가 협업 필터링 기법을 적용하여 데이터 행렬을 채운다.

|  | 제품1 | 제품2 | 제품3 | 제품4 | 제품5 | 제품6 |  |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 고객A | 1 |  | 1 |  | 1 | 1 |  |
| 고객B |  | 1 | 1 | 1 | 1 | 1 |  |

위의 표와 같은 상황이라면 고객A에게 제품 2와 제품4를 추천해준다.

### 그 외의 데이터 형식

- 복잡한 관계 및 의미의 개별 토큰으로 일련의 순서를 구서하는 단백질 사슬은 자연어로 표현된 문서와 꽤 유사하다. 실제로도 여러 유형의 단백질을 분석하는 최신 기법에는 NLP 딥러닝 방식이 활용되고 있다.

### 프로젝트 과정

- 데이터 수집
- 데이터에서 DataLoaders까지 → 전달받은 여러 DataLoader 객체를 목적에 맞게 학습용과 검증용으로 나누어 저장하는 클래스 (모델에 데이터를 제공하는 역할)
- 활용하려는 데이터의 이미지 크기가 다르면 딥러닝에서 문제가 발생할 수도 있다. 보통 한 번에 한장의 이미지만을 주입하지 않고 여러 이미지(미니배치)를 넣기 때문이다. 모델에 주입할 여러 이미지를 큰 배열(Tensor)로 구성하려면 모든 이미지의 크기가 같아야한다. 이미지의 크기를 똑같이 맞추는 변형(Transfrom)이 필요하다.
- 데이터 증강 → 입력 데이터를 임의로 변형해 새로운 데이터를 생성하는 기법 (이미지의 회전,뒤집기,원근 뒤틀기,명도 바꾸기 등등)

### 모델을 온라인 Application으로 전환하기

- 모델을 배포환경에서 사용하려면 파일 형태로 서버에 저장해야한다.
- 모델 (구조,파라미터로 나눌 수 있으며, 2가지를 모두 저장하는 것이 가장 쉽게 모델을 저장하는 방식이다.
    - 구조
    - 파라미터

# Chapter 3, Ethics (데이터 윤리)

딥러닝 실무자라면 언젠가는 데이터 윤리를 고려해야 하는 상황을 맞닥뜨릴 수 있다.

## 데이터 윤리의 핵심 사례

- 청원 절차
    - 건강관리 알고리즘을 구현한 후, 수백 명에게 제공하던 의료 서비스를 급격하게 줄였다. (혜택이 급격하게 줄었다는 뜻)
        - 건강관리 알고리즘의 버그로 인해 뇌성마비 환자가 받아야할 치료를 받지 못한 사례가 있다.
    - 데이터의 감사와 오류 수정의 중요성
- 피드백 루프
    - 구글이 설계한 시청 시간 최적화용 추천 알고리즘을 통해 시청되는 콘텐츠가 약 70%를 차지한다. 이 알고리즘은 통제 불가능한 피드백 루프를 만들어냈다. 계속해서 같은 종류의 영상만을 알고리즘이 추천하기 때문에 음모론 유행을 일으킨 사례가 있다.
    - 특정 동영상이 속한 채널은 동영상의 주요 주제를 분류하는 중요한 신호이다. 그렇다면 동영상이 어떤 주제를 가지고 있는지 확인하려면 해당 동영상이 속한 채널의 주제를 봐야하고, 또 해당 채널의 주제를 보려면 채널에 업로드된 동영상의 주제를 파악해야한다. 이러한 흐름으로 피드백 루프가 생성된다.
    - 피드백 루프를 끊기 위해서는 동영상을 채널과 함께 분류하는 방식, 그리고 채널 없이 분류하는 방식을 사용하여 끊을 수 있다.
- 편향
    - 관습적으로 흑인 이름에는 범죄 기록에 관련된 광고가 검색 결과에 포함되지만, 백인 이름에는 . 더중립적인 광고가 포함된다는 사실을 알아냈다.
    - 측정 편향
        - 잘못된 대상을 측정하거나, 잘못된 방식으로 측정하거나 모델에 해당 측정을 부적절한 방법으로 통합할 때 모델이 만들어내는 실수
    - 집계 편향
        - 모델이 모든 적절한 요인을 통합하는 방식으로 데이터를 집계하지 않거나, 모델이 필요한 교호작용 항, 비선형성 등을 포함하지 않을 때 발생한다. 서로 다른 그룹의 데이터를 합칠 때 발생하는 편향이다.
    - 대표성 편향
        - 데이터가 특정 그룹을 제대로 반영하지 못할 때 발생하는 편향

모델을 구축하는 모든 사람은 반드시 모델이 사용될 방향을 고려하고, 가능한 한 긍정적으로 사용되도록 최선을 다해야한다. 데이터의 윤리적 문제는 규제 및 법적 변화, 그리고 개인의 윤리적 행동이 모두 필요하다.
